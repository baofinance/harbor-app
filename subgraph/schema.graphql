type Deposit @entity(immutable: true) {
  id: ID! # {contractAddress}-{userAddress}-{txHash}-{logIndex}
  contractAddress: Bytes! # Genesis contract address
  user: Bytes! # User address
  amount: BigInt! # Amount deposited (in wei)
  amountUSD: BigDecimal # USD value at time of deposit
  timestamp: BigInt! # Block timestamp
  txHash: Bytes! # Transaction hash
  blockNumber: BigInt! # Block number
  # Harbor Marks tracking
  marksPerDay: BigDecimal! # Marks per day rate for this deposit
  isActive: Boolean! # Whether this deposit is still active (not withdrawn)
  # Withdrawal tracking
  withdrawnAmount: BigInt! # Amount withdrawn (0 if not withdrawn)
  withdrawnAt: BigInt # Timestamp when withdrawn (null if not withdrawn)
}

type Withdrawal @entity(immutable: true) {
  id: ID! # {contractAddress}-{userAddress}-{txHash}-{logIndex}
  contractAddress: Bytes! # Contract address
  user: Bytes! # User address
  amount: BigInt! # Amount withdrawn (in wei)
  amountUSD: BigDecimal # USD value at time of withdrawal
  timestamp: BigInt! # Block timestamp
  txHash: Bytes! # Transaction hash
  blockNumber: BigInt! # Block number
  # Marks forfeited
  marksForfeited: BigDecimal! # Marks forfeited due to this withdrawal
}

type GenesisEnd @entity(immutable: true) {
  id: ID! # {contractAddress}
  contractAddress: Bytes! # Genesis contract address
  timestamp: BigInt! # Block timestamp when genesis ended
  txHash: Bytes! # Transaction hash
  blockNumber: BigInt! # Block number
}

type UserHarborMarks @entity(immutable: false) {
  id: ID! # {contractAddress}-{userAddress}
  contractAddress: Bytes! # Contract address
  user: Bytes! # User address
  # Current marks
  currentMarks: BigDecimal! # Current marks earned (accumulated)
  marksPerDay: BigDecimal! # Current marks per day rate
  # Historical
  totalMarksEarned: BigDecimal! # Total marks ever earned
  totalMarksForfeited: BigDecimal! # Total marks forfeited from withdrawals
  bonusMarks: BigDecimal! # Bonus marks from genesis end (100 marks per dollar)
  # Deposits
  totalDeposited: BigInt! # Total amount ever deposited
  totalDepositedUSD: BigDecimal! # Total deposited in USD
  currentDeposit: BigInt! # Current active deposit
  currentDepositUSD: BigDecimal! # Current active deposit in USD
  # Genesis period
  genesisStartDate: BigInt! # Genesis start timestamp
  genesisEndDate: BigInt # Genesis end timestamp (null if not ended)
  genesisEnded: Boolean! # Whether genesis has ended
  # Last updated
  lastUpdated: BigInt! # Last block timestamp when updated
}

type UserList @entity(immutable: false) {
  id: ID! # {contractAddress}
  contractAddress: Bytes! # Contract address
  users: [Bytes!]! # Array of user addresses who have deposits
}

# ============ Entities for Multi-Market Marks Tracking ============

# Tracks ha token balances (from ERC20 transfers)
type HaTokenBalance @entity(immutable: false) {
  id: ID! # {tokenAddress}-{userAddress}
  tokenAddress: Bytes! # ha token contract address
  user: Bytes! # User address
  balance: BigInt! # Current token balance
  balanceUSD: BigDecimal! # Current balance in USD
  # Marks tracking
  marksPerDay: BigDecimal! # Current marks per day rate
  accumulatedMarks: BigDecimal! # Marks accumulated from this balance
  totalMarksEarned: BigDecimal! # Total marks ever earned from this token
  # Tracking
  firstSeenAt: BigInt! # First time user had balance > 0
  lastUpdated: BigInt! # Last block timestamp when updated
  # Market info
  marketId: String # Market identifier (optional, for grouping)
}

# Tracks sail token balances (from ERC20 transfers) - leveraged tokens with 5x multiplier
type SailTokenBalance @entity(immutable: false) {
  id: ID! # {tokenAddress}-{userAddress}
  tokenAddress: Bytes! # sail token contract address
  user: Bytes! # User address
  balance: BigInt! # Current token balance
  balanceUSD: BigDecimal! # Current balance in USD
  # Marks tracking
  marksPerDay: BigDecimal! # Current marks per day rate (includes 5x multiplier)
  accumulatedMarks: BigDecimal! # Marks accumulated from this balance
  totalMarksEarned: BigDecimal! # Total marks ever earned from this token
  # Tracking
  firstSeenAt: BigInt! # First time user had balance > 0
  lastUpdated: BigInt! # Last block timestamp when updated
  # Market info
  marketId: String # Market identifier (optional, for grouping)
}

# Tracks stability pool deposits
type StabilityPoolDeposit @entity(immutable: false) {
  id: ID! # {poolAddress}-{userAddress}
  poolAddress: Bytes! # Stability pool contract address
  user: Bytes! # User address
  balance: BigInt! # Current deposit balance
  balanceUSD: BigDecimal! # Current balance in USD
  # Marks tracking
  marksPerDay: BigDecimal! # Current marks per day rate
  accumulatedMarks: BigDecimal! # Marks accumulated from this deposit
  totalMarksEarned: BigDecimal! # Total marks ever earned from this pool
  # Tracking
  firstDepositAt: BigInt! # First deposit timestamp
  lastUpdated: BigInt! # Last block timestamp when updated
  # Pool type
  poolType: String! # "collateral" or "sail"
  # Market info
  marketId: String # Market identifier (optional, for grouping)
}

# Tracks marks multiplier configuration (updatable)
type MarksMultiplier @entity(immutable: false) {
  id: ID! # {sourceType}-{sourceAddress} or "global"
  sourceType: String! # "haToken", "stabilityPoolCollateral", "stabilityPoolSail", "genesis", or "global"
  sourceAddress: Bytes # Contract address (null for global)
  multiplier: BigDecimal! # Multiplier (1.0 = 1 mark/dollar/day, 2.0 = 2 marks/dollar/day, etc.)
  effectiveFrom: BigInt! # Block timestamp when multiplier became effective
  updatedAt: BigInt! # Last update timestamp
  updatedBy: Bytes # Address that updated (null if system)
}

# Tracks price feeds for USD calculations
type PriceFeed @entity(immutable: false) {
  id: ID! # {tokenAddress}
  tokenAddress: Bytes! # Token contract address
  priceFeedAddress: Bytes! # Price oracle address
  priceUSD: BigDecimal! # Current price in USD
  decimals: Int! # Price feed decimals
  lastUpdated: BigInt! # Last update timestamp
}

# Aggregated user marks across all sources
type UserTotalMarks @entity(immutable: false) {
  id: ID! # {userAddress}
  user: Bytes! # User address
  # Marks by source
  genesisMarks: BigDecimal! # Marks from Genesis deposits
  haTokenMarks: BigDecimal! # Marks from ha token balances (anchor tokens, 1x multiplier)
  sailTokenMarks: BigDecimal! # Marks from sail token balances (leveraged tokens, 5x multiplier)
  stabilityPoolMarks: BigDecimal! # Marks from stability pool deposits
  # Totals
  totalMarks: BigDecimal! # Total marks across all sources
  totalMarksPerDay: BigDecimal! # Total marks per day rate
  # Last updated
  lastUpdated: BigInt! # Last block timestamp when updated
}

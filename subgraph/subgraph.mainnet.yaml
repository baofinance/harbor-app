# Harbor Marks Subgraph - Ethereum Mainnet Configuration
# Deployment: Multi-market (stETH + WBTC)
# Last Updated: 2025-12-12
#
# Markets tracked:
#   - stETH market (test1-USD-stETH) - block 23993255
#   - WBTC market (test1-USD-WBTC) - block 23999551
#
# To deploy:
#   1. Copy this file to subgraph.yaml (or use: cp subgraph.mainnet.yaml subgraph.yaml)
#   2. Run: graph codegen && graph build
#   3. Deploy to The Graph Studio: npm run deploy:mainnet

specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # ============================================================================
  # MARKET 1: stETH (test1-USD-stETH)
  # ============================================================================
  
  # Genesis - stETH market
  - kind: ethereum
    name: Genesis
    network: mainnet
    source:
      address: "0x1454707877cdb966e29cea8a190c2169eeca4b8c"
      abi: Genesis
      startBlock: 23993255
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Deposit
        - Withdrawal
        - GenesisEnd
        - UserHarborMarks
        - UserList
        - MarksMultiplier
        - UserTotalMarks
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      file: ./src/genesis.ts

  # Pegged Token (haUSD-stETH) - anchor token for stETH market
  - kind: ethereum
    name: HaToken_haPB
    network: mainnet
    source:
      address: "0x6ff0fe773d4ad4ea923ba9ea9cc1c1b42b70f5fc"
      abi: ERC20
      startBlock: 23993255
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - HaTokenBalance
        - MarksMultiplier
        - UserTotalMarks
        - PriceFeed
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleHaTokenTransfer
      file: ./src/haToken.ts

  # Leveraged Token (hsUSD-stETH) - sail token for stETH market (5x marks multiplier)
  - kind: ethereum
    name: SailToken_hsPB
    network: mainnet
    source:
      address: "0x469ddfcfa98d0661b7efedc82aceeab84133f7fe"
      abi: ERC20
      startBlock: 23993255
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailTokenBalance
        - MarksMultiplier
        - UserTotalMarks
        - PriceFeed
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleSailTokenTransfer
      file: ./src/sailToken.ts

  # Stability Pool Collateral - stETH market (wstETH deposits)
  - kind: ethereum
    name: StabilityPoolCollateral
    network: mainnet
    source:
      address: "0xac8113ef28c8ef06064e8d78b69890d670273c73"
      abi: StabilityPool
      startBlock: 23993255
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - StabilityPoolDeposit
        - MarksMultiplier
        - UserTotalMarks
        - PriceFeed
      abis:
        - name: StabilityPool
          file: ./abis/StabilityPool.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleStabilityPoolDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleStabilityPoolWithdraw
        - event: UserDepositChange(indexed address,uint256,uint256)
          handler: handleStabilityPoolDepositChange
      file: ./src/stabilityPoolCollateral.ts

  # Stability Pool Leveraged - stETH market (hsUSD-stETH deposits)
  - kind: ethereum
    name: StabilityPoolLeveraged
    network: mainnet
    source:
      address: "0x6738c3ee945218fb80700e2f4c1a5f3022a28c8d"
      abi: StabilityPool
      startBlock: 23993255
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - StabilityPoolDeposit
        - MarksMultiplier
        - UserTotalMarks
        - PriceFeed
      abis:
        - name: StabilityPool
          file: ./abis/StabilityPool.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleStabilityPoolDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleStabilityPoolWithdraw
        - event: UserDepositChange(indexed address,uint256,uint256)
          handler: handleStabilityPoolDepositChange
      file: ./src/stabilityPoolLeveraged.ts

  # ============================================================================
  # MARKET 2: WBTC (test1-USD-WBTC)
  # ============================================================================
  
  # Genesis - WBTC market
  - kind: ethereum
    name: Genesis_WBTC
    network: mainnet
    source:
      address: "0x0569ebf818902e448235592f86e63255bbe64fd3"
      abi: Genesis
      startBlock: 23999551
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Deposit
        - Withdrawal
        - GenesisEnd
        - UserHarborMarks
        - UserList
        - MarksMultiplier
        - UserTotalMarks
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      file: ./src/genesisWBTC.ts

  # Leveraged Token (hsUSD-WBTC)
  - kind: ethereum
    name: HaToken_hsWBTC
    network: mainnet
    source:
      address: "0x03fd55f80277c13bb17739190b1e086b836c9f20"
      abi: ERC20
      startBlock: 23999551
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - HaTokenBalance
        - MarksMultiplier
        - UserTotalMarks
        - PriceFeed
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleHaTokenTransfer
      file: ./src/haTokenWBTC.ts

  # Stability Pool Collateral - WBTC market (wrapped WBTC deposits)
  - kind: ethereum
    name: StabilityPoolCollateral_WBTC
    network: mainnet
    source:
      address: "0x39613a4c9582dea56f9ee8ad0351011421c3593a"
      abi: StabilityPool
      startBlock: 23999551
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - StabilityPoolDeposit
        - MarksMultiplier
        - UserTotalMarks
        - PriceFeed
      abis:
        - name: StabilityPool
          file: ./abis/StabilityPool.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleStabilityPoolDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleStabilityPoolWithdraw
        - event: UserDepositChange(indexed address,uint256,uint256)
          handler: handleStabilityPoolDepositChange
      file: ./src/stabilityPoolCollateralWBTC.ts

  # Stability Pool Leveraged - WBTC market (hsUSD-WBTC deposits)
  - kind: ethereum
    name: StabilityPoolLeveraged_WBTC
    network: mainnet
    source:
      address: "0xfc2145de73ec53e34c4e6809b56a61321315e806"
      abi: StabilityPool
      startBlock: 23999551
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - StabilityPoolDeposit
        - MarksMultiplier
        - UserTotalMarks
        - PriceFeed
      abis:
        - name: StabilityPool
          file: ./abis/StabilityPool.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleStabilityPoolDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleStabilityPoolWithdraw
        - event: UserDepositChange(indexed address,uint256,uint256)
          handler: handleStabilityPoolDepositChange
      file: ./src/stabilityPoolLeveragedWBTC.ts

# Sail Tokens Subgraph - TEST2 (PnL + price history only)
# Tracks minter mint/redeem events and writes:
# - UserSailPosition, CostBasisLot, SailTokenMintEvent, SailTokenRedeemEvent
# - SailTokenPricePoint, HourlyPriceSnapshot, PriceTracker
specVersion: 0.0.8
schema:
  file: ./schema.graphql
dataSources:
  # ETH/fxUSD (test2)
  - kind: ethereum
    name: SailGenesis_ETH_fxUSD
    network: mainnet
    source:
      address: "0x5f4398e1d3e33f93e3d7ee710d797e2a154cb073"
      abi: Genesis
      startBlock: 24025347
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_ETH_fxUSD
    network: mainnet
    source:
      address: "0x565f90dc7c022e7857734352c7bf645852d8d4e7"
      abi: Minter
      startBlock: 24080000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
        - MinterHourlyTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts

  # BTC/fxUSD (test2)
  - kind: ethereum
    name: SailGenesis_BTC_fxUSD
    network: mainnet
    source:
      address: "0x288c61c3b3684ff21adf38d878c81457b19bd2fe"
      abi: Genesis
      startBlock: 24025557
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_BTC_fxUSD
    network: mainnet
    source:
      address: "0x7ffe3acb524fb40207709ba597d39c085d258f15"
      abi: Minter
      startBlock: 24080000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
        - MinterHourlyTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts

  # BTC/stETH (test2)
  - kind: ethereum
    name: SailGenesis_BTC_stETH
    network: mainnet
    source:
      address: "0x9ae0b57ceada0056dbe21edcd638476fcba3ccc0"
      abi: Genesis
      startBlock: 24025785
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_BTC_stETH
    network: mainnet
    source:
      address: "0x042e7cb5b993312490ea07fb89f360a65b8a9056"
      abi: Minter
      startBlock: 24080000
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
        - MinterHourlyTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts



# Sail Tokens Subgraph - PRODUCTION (PnL + price history only)
# Markets tracked:
#   - ETH/fxUSD (hsFXUSD-ETH)
#   - BTC/fxUSD (hsFXUSD-BTC)
#   - BTC/stETH (hsSTETH-BTC)
#   - stETH/EUR (hsSTETH-EUR)
#   - fxUSD/EUR (hsFXUSD-EUR)
specVersion: 0.0.8
schema:
  file: ./schema.graphql
features:
  - grafting
graft:
  # Base is the currently-published Gateway deployment (serving correct BTC fxUSD cost basis, etc).
  # We graft from just BEFORE genesis end so that genesis end is replayed with corrected stETH wrapped-rate handling.
  base: QmSGKrbUwYTmkmTGxyXUJUBwDqkBuDV6agnF12Twz2Fego
  block: 24164127
dataSources:
  # ETH/fxUSD (prod)
  - kind: ethereum
    name: SailGenesis_ETH_fxUSD
    network: mainnet
    source:
      address: "0xC9df4f62474Cf6cdE6c064DB29416a9F4f27EBdC"
      abi: Genesis
      startBlock: 24164127
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_ETH_fxUSD
    network: mainnet
    source:
      address: "0xd6E2F8e57b4aFB51C6fA4cbC012e1cE6aEad989F"
      abi: Minter
      startBlock: 24164127
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts

  # BTC/fxUSD (prod)
  - kind: ethereum
    name: SailGenesis_BTC_fxUSD
    network: mainnet
    source:
      address: "0x42cc9a19b358a2A918f891D8a6199d8b05F0BC1C"
      abi: Genesis
      startBlock: 24164127
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_BTC_fxUSD
    network: mainnet
    source:
      address: "0x33e32ff4d0677862fa31582CC654a25b9b1e4888"
      abi: Minter
      startBlock: 24164127
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts

  # BTC/stETH (prod)
  - kind: ethereum
    name: SailGenesis_BTC_stETH
    network: mainnet
    source:
      address: "0xc64Fc46eED431e92C1b5e24DC296b5985CE6Cc00"
      abi: Genesis
      startBlock: 24164127
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_BTC_stETH
    network: mainnet
    source:
      address: "0xF42516EB885E737780EB864dd07cEc8628000919"
      abi: Minter
      startBlock: 24164127
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts

  # stETH/EUR (prod)
  - kind: ethereum
    name: SailGenesis_stETH_EUR
    network: mainnet
    source:
      address: "0xD2858dda2025e2fb31069705D905E860CebFcFEF"
      abi: Genesis
      startBlock: 24271147
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_stETH_EUR
    network: mainnet
    source:
      address: "0x4121983289A6a3C2b6b31BF73dEF2F5732aECcaa"
      abi: Minter
      startBlock: 24271147
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts

  # fxUSD/EUR (prod)
  - kind: ethereum
    name: SailGenesis_fxUSD_EUR
    network: mainnet
    source:
      address: "0xb97D346DBC599e78C9c33B86BE6C796f2D141EcC"
      abi: Genesis
      startBlock: 24271147
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - SailGenesisUser
        - UserList
        - UserSailPosition
        - CostBasisLot
      abis:
        - name: Genesis
          file: ./abis/Genesis.json
        - name: ERC20
          file: ./abis/ERC20.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,uint256)
          handler: handleWithdraw
        - event: GenesisEnds()
          handler: handleGenesisEnd
      callHandlers:
        - function: endGenesis()
          handler: handleEndGenesis
      file: ./src/genesisPnL.ts

  - kind: ethereum
    name: Minter_fxUSD_EUR
    network: mainnet
    source:
      address: "0x625F6a8720ADF2757Ef92739E324a965b380b623"
      abi: Minter
      startBlock: 24271147
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - UserSailPosition
        - CostBasisLot
        - SailTokenMintEvent
        - SailTokenRedeemEvent
        - SailTokenPricePoint
        - HourlyPriceSnapshot
        - PriceTracker
      abis:
        - name: Minter
          file: ./abis/Minter.json
        - name: WrappedPriceOracle
          file: ./abis/WrappedPriceOracle.json
        - name: ChainlinkAggregator
          file: ./abis/ChainlinkAggregator.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: MintLeveragedToken(indexed address,indexed address,uint256,uint256)
          handler: handleMintLeveragedToken
        - event: RedeemLeveragedToken(indexed address,uint256,uint256)
          handler: handleRedeemLeveragedToken
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 240
      file: ./src/minterPnL.ts


